<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>
      Fixing cmdline for Non-Terminal Usage | Blog | Jade Michael Thornton
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      type="text/plain"
      rel="author"
      href="https://jmthornton.net/humans.txt"
    />

    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />
    <meta
      name="google-site-verification"
      content="JUM1Dl9n9ic9xPMb03Nzf4NgW_-8PWZrJ4eJGC_PoYM"
    />
    <link
      rel="shortcut icon"
      href="https://jmthornton.net/assets/images/favicon.png"
    />
    <link
      rel="apple-itouch-icon"
      href="https://jmthornton.net/assets/images/favicon.ico"
    />
    <link
      rel="preload"
      href="https://jmthornton.net/assets/fonts/MetroNova-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="https://jmthornton.net/assets/fonts/MetroNova-Italic.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="https://jmthornton.net/assets/fonts/MetroNova-Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="https://jmthornton.net/assets/fonts/MetroNova-BoldItalic.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="/assets/style/main.css" type="text/css" />

    <meta property="og:title" content="Fixing cmdline for Non-Terminal Usage" />
    <meta
      name="description"
      content="A fork of the TCL cmdline package that fixes a bug preventing usage in non-terminal contexts by removing the dependency on argv0."
    />
    <meta
      property="og:url"
      content="https://jmthornton.net/blog/p/cmdline-fork"
    />
    <meta property="og:site_name" content="jmthornton.net/blog" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="en_US" />
    <meta name="article:author" content="https://jmthornton.net/blog" />
    <meta property="article:published_time" content="2019-01-20" />
  </head>
  <body>
    <header>
      <nav>
        <a href="/">Home</a>
        <a href="/blog">Blog</a>
        <a href="/tools">Tools</a>
        <a href="https://weather.jmthornton.net">Weather</a>
        <a href="https://photos.jmthornton.net">Photos</a>
        <a href="https://emacs.jmthornton.net">Emacs</a>
      </nav>
    </header>

    <main>
      <article class="post blog-content">
        <h1 class="post-title">Fixing cmdline for Non-Terminal Usage</h1>
        <time datetime="2019-01-20">January 20, 2019</time>

        <div class="post-main">
          <div class="blog-body">
            <p>
              Working with TCL at FlightAware, I've run into more than a few
              frustrating bugs in the standard library packages. One that was
              particularly annoying was in the <code>cmdline</code> package,
              which is used for parsing command-line arguments. So I made
              <a href="https://github.com/thornjad/cmdline">a fork</a>.
            </p>

            <p>
              The problem was that the original relies on the global
              <code>argv0</code> variable to determine the application name for
              error messages. This works fine when TCL is running as a
              standalone script from the command line, but fails completely when
              TCL is embedded in other applications or used in non-terminal
              contexts where <code>argv0</code> doesn't exist. That's exactly
              what we do at FlightAware, where TCL runs in a server context.
            </p>

            <p>
              Rather than go through the painful process of contributing back to
              the original project (which uses Fossil for version control, a
              tool I'd rather avoid), I created a fork that fixes this specific
              issue. The fix was simple but effective: remove the dependency on
              <code>argv0</code> entirely and strip out the
              <code>getArgv0</code> function that was causing the problem.
            </p>

            <p>
              The result is a drop-in replacement for the standard
              <code>cmdline</code> package that works in all contexts, not just
              terminal applications. You can find it at
              <a href="https://github.com/thornjad/cmdline"
                >github.com/thornjad/cmdline</a
              >.
            </p>

            <p>
              This is exactly the kind of bug that makes working with TCL
              packages frustrating. The ecosystem has been stagnant for years,
              and we're stuck with these kinds of limitations until the language
              gets off of Fossil and into the modern world..
            </p>
          </div>
        </div>
      </article>
    </main>

    <footer>
      <p>
        Made with â™¥ in Minnesota | <a href="https://jmthornton.net">Home</a> |
        <a href="https://github.com/thornjad/jmthornton">Source code</a>
      </p>
    </footer>
  </body>
</html>
